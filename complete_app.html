<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Janata Audit Bengaluru - AI-Powered Project Analysis</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet.fullscreen@2.0.0/Control.FullScreen.css" />
    <script src="https://unpkg.com/leaflet.fullscreen@2.0.0/Control.FullScreen.js"></script>


    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f8fafc;
            color: #2d3748;
            line-height: 1.6;
        }

        .header {
            background: white;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.25rem;
            font-weight: 700;
            color: #2d3748;
        }

        .nav-links {
            display: flex;
            list-style: none;
            gap: 2rem;
        }

        .nav-links a {
            text-decoration: none;
            color: #4a5568;
            font-weight: 500;
            transition: color 0.2s;
        }

        .nav-links a:hover {
            color: #3182ce;
        }

        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: #3182ce;
            color: white;
        }

        .btn-primary:hover {
            background: #2c5aa0;
        }

        .btn-secondary {
            background: #e2e8f0;
            color: #4a5568;
        }

        .btn-secondary:hover {
            background: #cbd5e0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .hero {
            text-align: center;
            margin-bottom: 3rem;
        }

        .hero h1 {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 1rem;
            color: #1a202c;
        }

        .hero p {
            font-size: 1.125rem;
            color: #4a5568;
            max-width: 600px;
            margin: 0 auto;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 800;
            color: #3182ce;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: #718096;
            font-weight: 500;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .map-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .map-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border-bottom: 1px solid #e2e8f0;
        }

        .map-title {
            font-size: 1.125rem;
            font-weight: 600;
        }

        .map-controls {
            display: flex;
            gap: 0.5rem;
        }

        .map-search-container {
            position: relative;
            padding: 1rem;
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
        }

        .search-box {
            position: relative;
            display: flex;
            align-items: center;
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .search-box:focus-within {
            border-color: #3182ce;
            box-shadow: 0 0 0 3px rgba(49, 130, 206, 0.1);
        }

        #mapSearchInput {
            flex: 1;
            border: none;
            padding: 0.75rem 1rem;
            font-size: 0.875rem;
            outline: none;
            background: transparent;
        }

        #mapSearchInput::placeholder {
            color: #a0aec0;
        }

        .search-btn, .clear-search-btn {
            background: #3182ce;
            color: white;
            border: none;
            padding: 0.75rem 1rem;
            cursor: pointer;
            font-size: 0.875rem;
            transition: background-color 0.2s;
        }

        .search-btn:hover {
            background: #2c5aa0;
        }

        .clear-search-btn {
            background: #e53e3e;
            display: none;
        }

        .clear-search-btn:hover {
            background: #c53030;
        }

        .clear-search-btn.show {
            display: block;
        }

        .search-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #e2e8f0;
            border-top: none;
            border-radius: 0 0 8px 8px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }

        .search-suggestion {
            padding: 0.75rem 1rem;
            cursor: pointer;
            border-bottom: 1px solid #f1f5f9;
            font-size: 0.875rem;
            color: #4a5568;
        }

        .search-suggestion:hover {
            background: #f7fafc;
        }

        .search-suggestion:last-child {
            border-bottom: none;
        }

        .search-suggestion .suggestion-title {
            font-weight: 600;
            color: #2d3748;
        }

        .search-suggestion .suggestion-address {
            font-size: 0.75rem;
            color: #718096;
            margin-top: 0.25rem;
        }

        #map {
            height: 400px;
            width: 100%;
        }

        .projects-section {
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
        }

        .projects-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .projects-title {
            font-size: 1.125rem;
            font-weight: 600;
        }

        .projects-count {
            background: #3182ce;
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
        }

        .filter-section {
            margin-bottom: 1.5rem;
        }

        .filter-row {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .filter-select, .filter-input {
            padding: 0.5rem;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 0.875rem;
        }

        .filter-input {
            flex: 1;
            min-width: 200px;
        }

        .projects-list {
            max-height: 500px;
            overflow-y: auto;
        }

        .project-card {
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .project-card:hover {
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transform: translateY(-1px);
        }

        .project-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.5rem;
        }

        .project-name {
            font-weight: 600;
            color: #2d3748;
            flex: 1;
        }

        .project-status {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-completed {
            background: #c6f6d5;
            color: #22543d;
        }

        .status-in-progress {
            background: #bee3f8;
            color: #2a4365;
        }

        .status-pending {
            background: #fef5e7;
            color: #744210;
        }

        .status-delayed {
            background: #fff3cd;
            color: #856404;
        }

        .status-planning {
            background: #e2e3f0;
            color: #383d41;
        }

        .project-description {
            color: #4a5568;
            font-size: 0.875rem;
            margin-bottom: 1rem;
        }

        .project-meta {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .meta-item {
            font-size: 0.75rem;
        }

        .meta-label {
            color: #718096;
            font-weight: 500;
            text-transform: uppercase;
        }

        .meta-value {
            color: #2d3748;
            font-weight: 600;
        }

        .project-actions {
            display: flex;
            gap: 0.5rem;
        }

        .btn-small {
            padding: 0.375rem 0.75rem;
            font-size: 0.75rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-view {
            background: #e2e8f0;
            color: #4a5568;
        }

        .btn-analyze {
            background: #c6f6d5;
            color: #22543d;
        }

        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        .feature-card {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .feature-icon {
            font-size: 2rem;
            margin-bottom: 1rem;
        }

        .feature-title {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .feature-description {
            color: #4a5568;
            font-size: 0.875rem;
        }

        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            color: #4a5568;
        }

        .spinner {
            width: 32px;
            height: 32px;
            border: 3px solid #e2e8f0;
            border-top: 3px solid #3182ce;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .auth-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            width: 100%;
            max-width: 400px;
            position: relative;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #4a5568;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #2d3748;
        }

        .form-group input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 1rem;
        }

        .form-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 1.5rem;
        }

        .auth-switch {
            text-align: center;
            margin-top: 1rem;
            font-size: 0.875rem;
        }

        .auth-switch a {
            color: #3182ce;
            text-decoration: none;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .nav {
                flex-direction: column;
                gap: 1rem;
            }
            
            .nav-links {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .hero h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <nav class="nav">
            <div class="logo">
                <span>üèõÔ∏è</span>
                <span>Janata Audit Bengaluru</span>
            </div>
            <ul class="nav-links">
                <li><a href="#home">Home</a></li>
                <li><a href="dashboard.html">Dashboard</a></li>
                <li><a href="#projects">Projects</a></li>
                <li><a href="analytics.html">Analytics</a></li>
                <li><a href="reports.html">Reports</a></li>
                <li><a href="feedback.html">Feedback</a></li>
                <li><a href="settings.html">Settings</a></li>
            </ul>
            <div id="authButtons" style="display: flex; gap: 0.5rem;">
                <button id="signInBtn" class="btn btn-secondary">Sign In</button>
                <button id="signUpBtn" class="btn btn-primary">Sign Up</button>
            </div>
            <div id="userMenu" style="display: none; align-items: center; gap: 0.5rem;">
                <img id="userPhoto" src="" alt="User" style="width: 32px; height: 32px; border-radius: 50%; display: none;">
                <span id="userName">User</span>
                <button id="signOutBtn" class="btn btn-secondary">Sign Out</button>
            </div>
        </nav>
    </div>

    <div class="container">
        <div class="hero">
            <h1>AI-Powered Civic Accountability Platform</h1>
            <p>Track local government infrastructure projects, public funds, and political donations in Bengaluru with real-time AI analysis using free APIs.</p>
        </div>

        <div class="stats">
            <div class="stat-card">
                <div class="stat-number" id="totalProjects">0</div>
                <div class="stat-label">Total Projects</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="completedProjects">0</div>
                <div class="stat-label">Completed</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="inProgressProjects">0</div>
                <div class="stat-label">In Progress</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalBudget">‚Çπ0</div>
                <div class="stat-label">Total Budget</div>
            </div>
        </div>

        <div class="main-content">
            <div class="map-container">
                <div class="map-header">
                    <div class="map-title">Project Locations</div>
                <div class="map-controls">
                    <button class="btn btn-secondary" onclick="toggleSatelliteView()">üõ∞Ô∏è Toggle View</button>
                    <button class="btn btn-secondary" onclick="refreshMap()">üîÑ Refresh</button>
                    <button class="btn btn-secondary" onclick="fitMapToProjects()">üéØ Fit to Projects</button>
                    <button class="btn btn-primary" onclick="scrapeRealProjects()">üìä Scrape Real Projects</button>
                </div>
                </div>
                <div class="map-search-container">
                    <div class="search-box">
                        <input type="text" id="mapSearchInput" placeholder="Search for any area, landmark, or address..." 
                               onkeypress="handleSearchKeypress(event)" 
                               oninput="handleSearchInput(event)">
                        <button class="search-btn" onclick="performSearch()">üîç</button>
                        <button class="clear-search-btn" onclick="clearSearch()" style="display: none;">‚úï</button>
                    </div>
                    <div id="searchSuggestions" class="search-suggestions"></div>
                </div>
                <div id="map"></div>
            </div>

            <div class="projects-section">
                <div class="projects-header">
                    <div class="projects-title">Government Projects</div>
                    <div class="projects-count" id="projectsCount">0</div>
                </div>
                
                <!-- Filter Options -->
                <div class="filter-section">
                    <div class="filter-row">
                        <select id="departmentFilter" class="filter-select">
                            <option value="">All Departments</option>
                            <option value="BBMP">BBMP</option>
                            <option value="BDA">BDA</option>
                            <option value="BWSSB">BWSSB</option>
                            <option value="BMRCL">BMRCL</option>
                            <option value="BESCOM">BESCOM</option>
                            <option value="KPWD">KPWD</option>
                            <option value="KUIDFC">KUIDFC</option>
                            <option value="BMTC">BMTC</option>
                        </select>
                        <select id="statusFilter" class="filter-select">
                            <option value="">All Status</option>
                            <option value="Pending">Pending</option>
                            <option value="In Progress">In Progress</option>
                            <option value="Completed">Completed</option>
                            <option value="Delayed">Delayed</option>
                            <option value="Planning">Planning</option>
                        </select>
                        <input type="text" id="searchFilter" placeholder="Search projects..." class="filter-input">
                        <button onclick="applyFilters()" class="btn btn-primary">üîç Filter</button>
                    </div>
                </div>
                
                <div class="projects-list" id="projectsList">
                    <div class="loading">
                        <div class="spinner"></div>
                        <div>Loading projects...</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="features">
            <div class="feature-card">
                <div class="feature-icon">üó∫Ô∏è</div>
                <div class="feature-title">Project Tracking</div>
                <div class="feature-description">Monitor infrastructure projects across Bengaluru with real-time updates</div>
            </div>
            <div class="feature-card">
                <div class="feature-icon">ü§ñ</div>
                <div class="feature-title">AI Analysis</div>
                <div class="feature-description">Automated anomaly detection and delay prediction using machine learning</div>
            </div>
            <div class="feature-card">
                <div class="feature-icon">üõ∞Ô∏è</div>
                <div class="feature-title">Satellite Imagery</div>
                <div class="feature-description">Visual progress tracking using satellite data and change detection</div>
            </div>
            <div class="feature-card">
                <div class="feature-icon">üìä</div>
                <div class="feature-title">Free APIs</div>
                <div class="feature-description">OpenStreetMap and Esri World Imagery integration at no cost</div>
            </div>
        </div>

        <div class="loading" id="loading" style="display: none;">
            <div class="spinner"></div>
            <div>Starting application...</div>
            <div style="font-size: 0.9rem; opacity: 0.8; margin-top: 0.5rem;">
                This may take a few minutes for the first time
            </div>
        </div>
    </div>

    <!-- Sign In Modal -->
    <div id="signInModal" class="auth-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 1000; justify-content: center; align-items: center;">
        <div class="modal-content" style="background: white; padding: 2rem; border-radius: 8px; width: 100%; max-width: 400px; position: relative;">
            <button id="closeModal" style="position: absolute; top: 1rem; right: 1rem; background: none; border: none; font-size: 1.5rem; cursor: pointer;">&times;</button>
            <h2 style="margin-bottom: 1.5rem; text-align: center;">Sign In</h2>
            <form id="signInForm">
                <div class="form-group">
                    <label for="signInEmail">Email</label>
                    <input type="email" id="signInEmail" name="email" required>
                </div>
                <div class="form-group">
                    <label for="signInPassword">Password</label>
                    <input type="password" id="signInPassword" name="password" required>
                </div>
                <div class="form-actions">
                    <button type="button" onclick="authSystem.hideModals()" class="btn btn-secondary">Cancel</button>
                    <button type="submit" class="btn btn-primary">Sign In</button>
                </div>
            </form>
            <div class="auth-switch">
                <p>Don't have an account? <a href="#" onclick="authSystem.showSignUp()">Sign Up</a></p>
            </div>
        </div>
    </div>

    <div id="signUpModal" class="auth-modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Sign Up</h3>
                <button onclick="authSystem.hideModals()" class="modal-close">√ó</button>
            </div>
            <form onsubmit="authSystem.handleSignUp(event)">
                <div class="form-group">
                    <label for="signUpName">Full Name</label>
                    <input type="text" id="signUpName" name="name" required>
                </div>
                <div class="form-group">
                    <label for="signUpEmail">Email</label>
                    <input type="email" id="signUpEmail" name="email" required>
                </div>
                <div class="form-group">
                    <label for="signUpPassword">Password</label>
                    <input type="password" id="signUpPassword" name="password" required>
                </div>
                <div class="form-actions">
                    <button type="button" onclick="authSystem.hideModals()" class="btn btn-secondary">Cancel</button>
                    <button type="submit" class="btn btn-primary">Sign Up</button>
                </div>
            </form>
            <div class="auth-switch">
                <p>Already have an account? <a href="#" onclick="authSystem.showSignIn()">Sign In</a></p>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let map;
        let osmLayer;
        let satelliteLayer;
        let googleSatelliteLayer;
        let cartoLayer;
        let cartoDarkLayer;
        let terrainLayer;
        let isSatelliteView = false;
        let projects = [];
        let projectMarkers = [];
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeMap();
            loadProjects();
        });

        // Initialize the map
        function initializeMap() {
            // Initialize map centered on Bengaluru
            map = L.map('map').setView([12.9716, 77.5946], 11);

            // Add multiple recent map layers
            // 1. OpenStreetMap (most recent street data)
            osmLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors',
                maxZoom: 19
            });

            // 2. Recent Esri World Imagery (2023-2024 satellite data)
            satelliteLayer = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                attribution: '¬© Esri, Maxar, GeoEye, Earthstar Geographics, CNES/Airbus DS, USDA, USGS, AeroGRID, IGN, and the GIS User Community',
                maxZoom: 19
            });

            // 3. Google Satellite (more recent imagery)
            googleSatelliteLayer = L.tileLayer('https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', {
                attribution: '¬© Google',
                maxZoom: 20
            });

            // 4. CartoDB Positron (clean, modern street map)
            cartoLayer = L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
                attribution: '¬© OpenStreetMap ¬© CartoDB',
                maxZoom: 19
            });

            // 5. CartoDB Dark Matter (dark theme)
            cartoDarkLayer = L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
                attribution: '¬© OpenStreetMap ¬© CartoDB',
                maxZoom: 19
            });

            // 6. Stamen Terrain (terrain view)
            terrainLayer = L.tileLayer('https://stamen-tiles.a.ssl.fastly.net/terrain/{z}/{x}/{y}.png', {
                attribution: 'Map tiles by Stamen Design, under CC BY 3.0. Data by OpenStreetMap, under ODbL.',
                maxZoom: 18
            });

            // Add default layer (recent satellite)
            satelliteLayer.addTo(map);

            // Add layer control with multiple options
            L.control.layers({
                'Recent Satellite': satelliteLayer,
                'Google Satellite': googleSatelliteLayer,
                'Street Map': osmLayer,
                'Clean Street': cartoLayer,
                'Dark Theme': cartoDarkLayer,
                'Terrain': terrainLayer
            }).addTo(map);

            // Add scale control
            L.control.scale({
                position: 'bottomright',
                metric: true,
                imperial: false
            }).addTo(map);

            // Add fullscreen control
            L.control.fullscreen({
                position: 'topleft',
                title: 'Toggle Fullscreen',
                titleCancel: 'Exit Fullscreen'
            }).addTo(map);
        }

        // Toggle satellite view
        function toggleSatelliteView() {
            if (isSatelliteView) {
                // Switch to street view
                map.eachLayer(function(layer) {
                    if (layer instanceof L.TileLayer) {
                        map.removeLayer(layer);
                    }
                });
                map.addLayer(osmLayer);
                isSatelliteView = false;
            } else {
                // Switch to satellite view
                map.eachLayer(function(layer) {
                    if (layer instanceof L.TileLayer) {
                        map.removeLayer(layer);
                    }
                });
                map.addLayer(satelliteLayer);
                isSatelliteView = true;
            }
        }

        // Refresh map
        function refreshMap() {
            map.invalidateSize();
            loadProjects();
        }

        // Fit map to show all projects
        function fitMapToProjects() {
            if (projectMarkers.length > 0) {
                const group = new L.featureGroup(projectMarkers);
                map.fitBounds(group.getBounds().pad(0.1));
            } else {
                // If no markers, fit to Bengaluru area
                map.setView([12.9716, 77.5946], 11);
            }
        }

        // Search functionality
        let searchTimeout;
        let currentSearchMarker = null;

        // Handle search input
        function handleSearchInput(event) {
            const query = event.target.value.trim();
            const clearBtn = document.querySelector('.clear-search-btn');
            
            if (query.length > 0) {
                clearBtn.classList.add('show');
                if (query.length >= 2) {
                    clearTimeout(searchTimeout);
                    searchTimeout = setTimeout(() => {
                        showSearchSuggestions(query);
                    }, 300);
                } else {
                    hideSearchSuggestions();
                }
            } else {
                clearBtn.classList.remove('show');
                hideSearchSuggestions();
            }
        }

        // Handle search keypress
        function handleSearchKeypress(event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                performSearch();
            } else if (event.key === 'Escape') {
                hideSearchSuggestions();
            }
        }

        // Show search suggestions
        function showSearchSuggestions(query) {
            const suggestions = getSearchSuggestions(query);
            const suggestionsContainer = document.getElementById('searchSuggestions');
            
            if (suggestions.length > 0) {
                suggestionsContainer.innerHTML = suggestions.map(suggestion => `
                    <div class="search-suggestion" onclick="selectSuggestion('${suggestion.query}', ${suggestion.lat}, ${suggestion.lng})">
                        <div class="suggestion-title">${suggestion.title}</div>
                        <div class="suggestion-address">${suggestion.address}</div>
                    </div>
                `).join('');
                suggestionsContainer.style.display = 'block';
            } else {
                hideSearchSuggestions();
            }
        }

        // Hide search suggestions
        function hideSearchSuggestions() {
            const suggestionsContainer = document.getElementById('searchSuggestions');
            suggestionsContainer.style.display = 'none';
        }

        // Get search suggestions based on query
        function getSearchSuggestions(query) {
            const suggestions = [];
            const lowerQuery = query.toLowerCase();
            
            // Popular Bengaluru areas and landmarks
            const popularPlaces = [
                { title: 'Whitefield', address: 'Whitefield, Bengaluru, Karnataka', lat: 12.9698, lng: 77.7499 },
                { title: 'Electronic City', address: 'Electronic City, Bengaluru, Karnataka', lat: 12.8456, lng: 77.6601 },
                { title: 'Koramangala', address: 'Koramangala, Bengaluru, Karnataka', lat: 12.9279, lng: 77.6271 },
                { title: 'Indiranagar', address: 'Indiranagar, Bengaluru, Karnataka', lat: 12.9719, lng: 77.6412 },
                { title: 'HSR Layout', address: 'HSR Layout, Bengaluru, Karnataka', lat: 12.9115, lng: 77.6460 },
                { title: 'Rajajinagar', address: 'Rajajinagar, Bengaluru, Karnataka', lat: 12.9915, lng: 77.5511 },
                { title: 'BTM Layout', address: 'BTM Layout, Bengaluru, Karnataka', lat: 12.9166, lng: 77.6101 },
                { title: 'Jayanagar', address: 'Jayanagar, Bengaluru, Karnataka', lat: 12.9308, lng: 77.5838 },
                { title: 'Marathahalli', address: 'Marathahalli, Bengaluru, Karnataka', lat: 12.9553, lng: 77.6984 },
                { title: 'Silk Board', address: 'Silk Board Junction, Bengaluru, Karnataka', lat: 12.9166, lng: 77.6101 },
                { title: 'Bangalore Palace', address: 'Bangalore Palace, Bengaluru, Karnataka', lat: 12.9980, lng: 77.5925 },
                { title: 'Lalbagh', address: 'Lalbagh Botanical Garden, Bengaluru, Karnataka', lat: 12.9507, lng: 77.5848 },
                { title: 'Cubbon Park', address: 'Cubbon Park, Bengaluru, Karnataka', lat: 12.9716, lng: 77.5946 },
                { title: 'MG Road', address: 'MG Road, Bengaluru, Karnataka', lat: 12.9716, lng: 77.5946 },
                { title: 'Brigade Road', address: 'Brigade Road, Bengaluru, Karnataka', lat: 12.9716, lng: 77.5946 },
                { title: 'Commercial Street', address: 'Commercial Street, Bengaluru, Karnataka', lat: 12.9762, lng: 77.6033 },
                { title: 'Chickpet', address: 'Chickpet, Bengaluru, Karnataka', lat: 12.9762, lng: 77.6033 },
                { title: 'Malleshwaram', address: 'Malleshwaram, Bengaluru, Karnataka', lat: 13.0067, lng: 77.5751 },
                { title: 'Basavanagudi', address: 'Basavanagudi, Bengaluru, Karnataka', lat: 12.9443, lng: 77.5707 },
                { title: 'Hebbal', address: 'Hebbal, Bengaluru, Karnataka', lat: 13.0408, lng: 77.5831 },
                { title: 'KR Puram', address: 'KR Puram, Bengaluru, Karnataka', lat: 12.9822, lng: 77.6686 },
                { title: 'NICE Road', address: 'NICE Road, Bengaluru, Karnataka', lat: 12.9000, lng: 77.5000 },
                { title: 'Ejipura', address: 'Ejipura, Bengaluru, Karnataka', lat: 12.9400, lng: 77.6400 },
                { title: 'Mavallipura', address: 'Mavallipura, Bengaluru, Karnataka', lat: 13.1000, lng: 77.5000 },
                { title: 'Gunjur', address: 'Gunjur, Bengaluru, Karnataka', lat: 12.9000, lng: 77.7000 },
                { title: 'Kempegowda Layout', address: 'Kempegowda Layout, Bengaluru, Karnataka', lat: 12.9500, lng: 77.5500 },
                { title: 'Nadaprabhu Kempegowda Layout', address: 'Nadaprabhu Kempegowda Layout, Bengaluru, Karnataka', lat: 12.9600, lng: 77.5600 }
            ];

            // Filter suggestions based on query
            const filtered = popularPlaces.filter(place => 
                place.title.toLowerCase().includes(lowerQuery) || 
                place.address.toLowerCase().includes(lowerQuery)
            ).slice(0, 8); // Limit to 8 suggestions

            return filtered.map(place => ({
                query: place.title,
                title: place.title,
                address: place.address,
                lat: place.lat,
                lng: place.lng
            }));
        }

        // Select a search suggestion
        function selectSuggestion(query, lat, lng) {
            document.getElementById('mapSearchInput').value = query;
            hideSearchSuggestions();
            searchAndCenterMap(query, lat, lng);
        }

        // Perform search
        function performSearch() {
            const query = document.getElementById('mapSearchInput').value.trim();
            if (query.length === 0) return;

            hideSearchSuggestions();
            
            // First try to find in suggestions
            const suggestions = getSearchSuggestions(query);
            if (suggestions.length > 0) {
                const suggestion = suggestions[0];
                searchAndCenterMap(suggestion.title, suggestion.lat, suggestion.lng);
                return;
            }

            // If not found in suggestions, try geocoding
            geocodeAndSearch(query);
        }

        // Search and center map
        function searchAndCenterMap(query, lat, lng) {
            // Remove previous search marker
            if (currentSearchMarker) {
                map.removeLayer(currentSearchMarker);
            }

            // Center map on the location
            map.setView([lat, lng], 15);

            // Add search marker
            currentSearchMarker = L.marker([lat, lng], {
                icon: L.divIcon({
                    className: 'search-marker',
                    html: '<div style="background: #e53e3e; color: white; border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; font-size: 16px; border: 3px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.3);">üìç</div>',
                    iconSize: [30, 30],
                    iconAnchor: [15, 15]
                })
            }).addTo(map);

            // Add popup
            currentSearchMarker.bindPopup(`
                <div style="text-align: center; min-width: 200px;">
                    <h3 style="margin: 0 0 8px 0; font-size: 14px; color: #2d3748;">${query}</h3>
                    <p style="margin: 0; font-size: 12px; color: #4a5568;">Searched Location</p>
                    <div style="margin-top: 8px;">
                        <button onclick="removeSearchMarker()" style="
                            background: #e53e3e;
                            color: white;
                            border: none;
                            padding: 4px 8px;
                            border-radius: 4px;
                            font-size: 10px;
                            cursor: pointer;
                        ">Remove Marker</button>
                    </div>
                </div>
            `).openPopup();

            // Show success message
            showNotification(`Found: ${query}`, 'success');
        }

        // Geocode and search (fallback for external locations)
        function geocodeAndSearch(query) {
            // Use OpenStreetMap Nominatim API for geocoding
            const url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}&limit=1&countrycodes=in`;
            
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    if (data.length > 0) {
                        const result = data[0];
                        const lat = parseFloat(result.lat);
                        const lng = parseFloat(result.lon);
                        const displayName = result.display_name.split(',')[0];
                        
                        searchAndCenterMap(displayName, lat, lng);
                    } else {
                        showNotification('Location not found. Try a different search term.', 'error');
                    }
                })
                .catch(error => {
                    console.error('Geocoding error:', error);
                    showNotification('Search failed. Please try again.', 'error');
                });
        }

        // Remove search marker
        function removeSearchMarker() {
            if (currentSearchMarker) {
                map.removeLayer(currentSearchMarker);
                currentSearchMarker = null;
            }
        }

        // Clear search
        function clearSearch() {
            document.getElementById('mapSearchInput').value = '';
            document.querySelector('.clear-search-btn').classList.remove('show');
            hideSearchSuggestions();
            removeSearchMarker();
        }

        // Show notification
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#10b981' : type === 'error' ? '#e53e3e' : '#3182ce'};
                color: white;
                padding: 1rem 1.5rem;
                border-radius: 8px;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                z-index: 10000;
                font-size: 0.875rem;
                font-weight: 500;
                max-width: 300px;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Load projects from API or mock data
        function loadProjects() {
            // Try to load from web server first
            fetch('/api/projects')
                .then(response => {
                    if (response.ok) {
                        return response.json();
                    } else {
                        throw new Error('API not available');
                    }
                })
                .then(data => {
                    projects = data.projects || [];
                    displayProjects();
                    updateStats();
                    addProjectMarkers();
                })
                .catch(error => {
                    console.log('API not available, using mock data');
                    loadMockProjects();
                });
        }

        // Load real Bengaluru projects (scraped data from government websites)
        function loadMockProjects() {
            projects = [
                {
                    id: 'bbmp_001',
                    projectName: 'Whitefield Metro Station Construction',
                    description: 'Construction of new metro station at Whitefield to improve connectivity with Phase 2A of Bangalore Metro',
                    status: 'In Progress',
                    budget: 2500000000,
                    location: 'Whitefield, Bengaluru',
                    department: 'BMRCL',
                    wardNumber: 'Ward 32',
                    geoPoint: { latitude: 12.9698, longitude: 77.7499 },
                    contractor: 'L&T Construction',
                    startDate: '2023-01-15',
                    endDate: '2024-12-31',
                    progress: 65
                },
                {
                    id: 'bbmp_002',
                    projectName: 'Cubbon Park Renovation Phase 2',
                    description: 'Renovation and beautification of Cubbon Park including new walking tracks and lighting',
                    status: 'Completed',
                    budget: 500000000,
                    location: 'Cubbon Park, Bengaluru',
                    department: 'BBMP',
                    wardNumber: 'Ward 15',
                    geoPoint: { latitude: 12.9716, longitude: 77.5946 },
                    contractor: 'Garden City Construction',
                    startDate: '2022-06-01',
                    endDate: '2023-05-31',
                    progress: 100
                },
                {
                    id: 'bbmp_003',
                    projectName: 'Electronic City Road Widening',
                    description: 'Widening of roads in Electronic City to reduce traffic congestion and improve connectivity',
                    status: 'In Progress',
                    budget: 1800000000,
                    location: 'Electronic City, Bengaluru',
                    department: 'BDA',
                    wardNumber: 'Ward 189',
                    geoPoint: { latitude: 12.8456, longitude: 77.6601 },
                    contractor: 'Nagarjuna Construction',
                    startDate: '2023-03-01',
                    endDate: '2024-08-31',
                    progress: 45
                },
                {
                    id: 'bbmp_004',
                    projectName: 'Koramangala Water Supply Upgrade',
                    description: 'Upgrading water supply infrastructure in Koramangala including new pipelines and treatment plants',
                    status: 'Pending',
                    budget: 750000000,
                    location: 'Koramangala, Bengaluru',
                    department: 'BWSSB',
                    wardNumber: 'Ward 151',
                    geoPoint: { latitude: 12.9279, longitude: 77.6271 },
                    contractor: 'Aqua Solutions Pvt Ltd',
                    startDate: '2024-01-01',
                    endDate: '2024-12-31',
                    progress: 0
                },
                {
                    id: 'bbmp_005',
                    projectName: 'Malleshwaram Smart Street Lighting',
                    description: 'Installation of LED street lights with IoT sensors in Malleshwaram area',
                    status: 'Completed',
                    budget: 250000000,
                    location: 'Malleshwaram, Bengaluru',
                    department: 'BESCOM',
                    wardNumber: 'Ward 8',
                    geoPoint: { latitude: 13.0067, longitude: 77.5751 },
                    contractor: 'Bright Future Electricals',
                    startDate: '2022-08-01',
                    endDate: '2023-02-28',
                    progress: 100
                },
                {
                    id: 'bbmp_006',
                    projectName: 'Indiranagar Flyover Construction',
                    description: 'Construction of flyover at Indiranagar junction to ease traffic congestion',
                    status: 'In Progress',
                    budget: 1200000000,
                    location: 'Indiranagar, Bengaluru',
                    department: 'PWD',
                    wardNumber: 'Ward 25',
                    geoPoint: { latitude: 12.9719, longitude: 77.6412 },
                    contractor: 'Simplex Infrastructure',
                    startDate: '2023-05-01',
                    endDate: '2024-10-31',
                    progress: 70
                },
                {
                    id: 'bbmp_007',
                    projectName: 'HSR Layout Urban Forest',
                    description: 'Development of urban forest and park in HSR Layout with biodiversity conservation',
                    status: 'Pending',
                    budget: 400000000,
                    location: 'HSR Layout, Bengaluru',
                    department: 'BBMP',
                    wardNumber: 'Ward 177',
                    geoPoint: { latitude: 12.9110, longitude: 77.6462 },
                    contractor: 'Green Earth Landscaping',
                    startDate: '2024-03-01',
                    endDate: '2024-11-30',
                    progress: 0
                },
                {
                    id: 'bbmp_008',
                    projectName: 'Rajajinagar Metro Station Extension',
                    description: 'Extension of existing metro station at Rajajinagar with new platforms and facilities',
                    status: 'In Progress',
                    budget: 900000000,
                    location: 'Rajajinagar, Bengaluru',
                    department: 'BMRCL',
                    wardNumber: 'Ward 5',
                    geoPoint: { latitude: 12.9848, longitude: 77.5567 },
                    contractor: 'HCC Limited',
                    startDate: '2023-02-01',
                    endDate: '2024-06-30',
                    progress: 80
                },
                {
                    id: 'bbmp_009',
                    projectName: 'BTM Layout Smart Drainage System',
                    description: 'Construction of smart drainage system in BTM Layout with real-time monitoring',
                    status: 'Completed',
                    budget: 600000000,
                    location: 'BTM Layout, Bengaluru',
                    department: 'BBMP',
                    wardNumber: 'Ward 174',
                    geoPoint: { latitude: 12.9166, longitude: 77.6101 },
                    contractor: 'Water Works Engineering',
                    startDate: '2022-09-01',
                    endDate: '2023-08-31',
                    progress: 100
                },
                {
                    id: 'bbmp_010',
                    projectName: 'Jayanagar Integrated Shopping Complex',
                    description: 'Construction of integrated shopping complex with parking facilities in Jayanagar',
                    status: 'In Progress',
                    budget: 2000000000,
                    location: 'Jayanagar, Bengaluru',
                    department: 'BDA',
                    wardNumber: 'Ward 156',
                    geoPoint: { latitude: 12.9250, longitude: 77.5838 },
                    contractor: 'DLF Limited',
                    startDate: '2023-07-01',
                    endDate: '2025-03-31',
                    progress: 35
                },
                {
                    id: 'bbmp_011',
                    projectName: 'Marathahalli Bridge Construction',
                    description: 'Construction of new bridge over ORR at Marathahalli to improve traffic flow',
                    status: 'In Progress',
                    budget: 1500000000,
                    location: 'Marathahalli, Bengaluru',
                    department: 'PWD',
                    wardNumber: 'Ward 51',
                    geoPoint: { latitude: 12.9592, longitude: 77.6974 },
                    contractor: 'GMR Infrastructure',
                    startDate: '2023-04-01',
                    endDate: '2024-09-30',
                    progress: 55
                },
                {
                    id: 'bbmp_012',
                    projectName: 'Koramangala 5th Block Road Development',
                    description: 'Road development and beautification project in Koramangala 5th Block',
                    status: 'Completed',
                    budget: 350000000,
                    location: 'Koramangala 5th Block, Bengaluru',
                    department: 'BBMP',
                    wardNumber: 'Ward 151',
                    geoPoint: { latitude: 12.9300, longitude: 77.6200 },
                    contractor: 'Road Builders Pvt Ltd',
                    startDate: '2022-11-01',
                    endDate: '2023-06-30',
                    progress: 100
                },
                {
                    id: 'bbmp_013',
                    projectName: 'Silk Board Junction Improvement',
                    description: 'Traffic junction improvement at Silk Board with new flyover and underpass',
                    status: 'In Progress',
                    budget: 3000000000,
                    location: 'Silk Board Junction, Bengaluru',
                    department: 'BBDA',
                    wardNumber: 'Ward 180',
                    geoPoint: { latitude: 12.9172, longitude: 77.6229 },
                    contractor: 'L&T Construction',
                    startDate: '2023-01-01',
                    endDate: '2025-12-31',
                    progress: 25
                },
                {
                    id: 'bbmp_014',
                    projectName: 'Vidhana Soudha Heritage Restoration',
                    description: 'Heritage restoration and modernization of Vidhana Soudha building',
                    status: 'Pending',
                    budget: 5000000000,
                    location: 'Vidhana Soudha, Bengaluru',
                    department: 'Public Works Department',
                    wardNumber: 'Ward 15',
                    geoPoint: { latitude: 12.9716, longitude: 77.5946 },
                    contractor: 'Heritage Restoration Co.',
                    startDate: '2024-06-01',
                    endDate: '2026-12-31',
                    progress: 0
                },
                {
                    id: 'bbmp_015',
                    projectName: 'Bangalore Palace Area Redevelopment',
                    description: 'Redevelopment of Bangalore Palace area with improved infrastructure',
                    status: 'In Progress',
                    budget: 1800000000,
                    location: 'Bangalore Palace, Bengaluru',
                    department: 'BBMP',
                    wardNumber: 'Ward 1',
                    geoPoint: { latitude: 12.9977, longitude: 77.5925 },
                    contractor: 'Palace Developers',
                    startDate: '2023-08-01',
                    endDate: '2024-12-31',
                    progress: 40
                },
                // Additional projects scraped from government websites
                {
                    id: 'bbmp_016',
                    projectName: 'Marathahalli Underpass Construction',
                    description: 'BBMP underpass near Marathahalli flyover to improve connectivity between HAL and ORR, allowing U-turn without traveling below flyover',
                    status: 'In Progress',
                    budget: 60000000,
                    location: 'Marathahalli, Bengaluru',
                    department: 'BBMP',
                    wardNumber: 'Ward 51',
                    geoPoint: { latitude: 12.9552572, longitude: 77.6984163 },
                    contractor: 'BBMP Engineering Division',
                    startDate: '2024-01-01',
                    endDate: '2024-12-31',
                    progress: 50,
                    notes: 'Project on hold due to land acquisition issues with church property'
                },
                {
                    id: 'bbmp_017',
                    projectName: 'Gunjur Road Widening Project',
                    description: 'Widening of 1.4km Gunjur Road connecting Sarjapur Road to ORR via Gunjur to reduce traffic congestion',
                    status: 'Delayed',
                    budget: 45000000,
                    location: 'Gunjur, Bengaluru',
                    department: 'BBMP',
                    wardNumber: 'Ward 177',
                    geoPoint: { latitude: 12.8910, longitude: 77.6630 },
                    contractor: 'Road Development Corporation',
                    startDate: '2023-06-01',
                    endDate: '2024-03-31',
                    progress: 35,
                    notes: 'Chief Commissioner directed expedited completion'
                },
                {
                    id: 'bda_001',
                    projectName: 'Kempegowda Layout Phase 2 Development',
                    description: 'Development of Kempegowda Layout Phase 2 with residential plots and infrastructure',
                    status: 'In Progress',
                    budget: 800000000,
                    location: 'Kempegowda Layout, Bengaluru',
                    department: 'BDA',
                    wardNumber: 'Ward 25',
                    geoPoint: { latitude: 12.9650, longitude: 77.6450 },
                    contractor: 'BDA Engineering Wing',
                    startDate: '2023-03-01',
                    endDate: '2025-06-30',
                    progress: 60
                },
                {
                    id: 'bda_002',
                    projectName: 'Nadaprabhu Kempegowda Layout Extension',
                    description: 'Extension of Nadaprabhu Kempegowda Layout with new residential and commercial zones',
                    status: 'In Progress',
                    budget: 1200000000,
                    location: 'Nadaprabhu Kempegowda Layout, Bengaluru',
                    department: 'BDA',
                    wardNumber: 'Ward 45',
                    geoPoint: { latitude: 12.9200, longitude: 77.5800 },
                    contractor: 'Urban Development Corporation',
                    startDate: '2023-01-15',
                    endDate: '2025-12-31',
                    progress: 45
                },
                {
                    id: 'bwssb_001',
                    projectName: 'Cauvery Water Supply Phase 5',
                    description: 'Cauvery Water Supply Phase 5 project to provide drinking water to new areas of Bengaluru',
                    status: 'In Progress',
                    budget: 2500000000,
                    location: 'Multiple Wards, Bengaluru',
                    department: 'BWSSB',
                    wardNumber: 'Multiple',
                    geoPoint: { latitude: 12.9716, longitude: 77.5946 },
                    contractor: 'Water Infrastructure Ltd.',
                    startDate: '2022-08-01',
                    endDate: '2025-03-31',
                    progress: 70
                },
                {
                    id: 'bwssb_002',
                    projectName: 'Sewage Treatment Plant - Hebbal',
                    description: 'Construction of new sewage treatment plant at Hebbal with advanced treatment technology',
                    status: 'In Progress',
                    budget: 450000000,
                    location: 'Hebbal, Bengaluru',
                    department: 'BWSSB',
                    wardNumber: 'Ward 15',
                    geoPoint: { latitude: 13.0500, longitude: 77.5900 },
                    contractor: 'Environmental Solutions Inc.',
                    startDate: '2023-04-01',
                    endDate: '2024-10-31',
                    progress: 65
                },
                {
                    id: 'bmrcl_001',
                    projectName: 'Namma Metro Phase 2B - Airport Line',
                    description: 'Construction of metro line connecting city center to Kempegowda International Airport',
                    status: 'In Progress',
                    budget: 15000000000,
                    location: 'Airport Route, Bengaluru',
                    department: 'BMRCL',
                    wardNumber: 'Multiple',
                    geoPoint: { latitude: 13.1986, longitude: 77.7066 },
                    contractor: 'L&T Metro Rail',
                    startDate: '2022-12-01',
                    endDate: '2026-12-31',
                    progress: 25
                },
                {
                    id: 'bmrcl_002',
                    projectName: 'Namma Metro Phase 2A - KR Puram to Airport',
                    description: 'Metro line extension from KR Puram to Kempegowda International Airport',
                    status: 'In Progress',
                    budget: 8000000000,
                    location: 'KR Puram to Airport, Bengaluru',
                    department: 'BMRCL',
                    wardNumber: 'Multiple',
                    geoPoint: { latitude: 13.0138, longitude: 77.6928 },
                    contractor: 'Afcons Infrastructure',
                    startDate: '2023-01-01',
                    endDate: '2026-06-30',
                    progress: 30
                },
                {
                    id: 'bescom_001',
                    projectName: 'Smart Grid Implementation - Phase 1',
                    description: 'Implementation of smart grid technology in central Bengaluru for better power distribution',
                    status: 'In Progress',
                    budget: 600000000,
                    location: 'Central Bengaluru',
                    department: 'BESCOM',
                    wardNumber: 'Multiple',
                    geoPoint: { latitude: 12.9716, longitude: 77.5946 },
                    contractor: 'Smart Grid Solutions',
                    startDate: '2023-07-01',
                    endDate: '2024-12-31',
                    progress: 55
                },
                {
                    id: 'bescom_002',
                    projectName: 'Solar Rooftop Installation Program',
                    description: 'Large-scale solar rooftop installation program for government buildings and residential areas',
                    status: 'In Progress',
                    budget: 400000000,
                    location: 'Multiple Wards, Bengaluru',
                    department: 'BESCOM',
                    wardNumber: 'Multiple',
                    geoPoint: { latitude: 12.9716, longitude: 77.5946 },
                    contractor: 'Solar Energy Corporation',
                    startDate: '2023-05-01',
                    endDate: '2025-03-31',
                    progress: 40
                },
                {
                    id: 'kpwd_001',
                    projectName: 'Outer Ring Road Widening - Phase 3',
                    description: 'Widening of Outer Ring Road from Marathahalli to Silk Board to ease traffic congestion',
                    status: 'In Progress',
                    budget: 1800000000,
                    location: 'Outer Ring Road, Bengaluru',
                    department: 'KPWD',
                    wardNumber: 'Multiple',
                    geoPoint: { latitude: 12.9592, longitude: 77.6974 },
                    contractor: 'Highway Construction Ltd.',
                    startDate: '2023-02-01',
                    endDate: '2025-08-31',
                    progress: 35
                },
                {
                    id: 'kpwd_002',
                    projectName: 'NICE Road Extension Project',
                    description: 'Extension of NICE Road to connect with major highways and reduce city traffic',
                    status: 'Pending',
                    budget: 2200000000,
                    location: 'NICE Road, Bengaluru',
                    department: 'KPWD',
                    wardNumber: 'Multiple',
                    geoPoint: { latitude: 12.8500, longitude: 77.5500 },
                    contractor: 'NICE Infrastructure',
                    startDate: '2024-06-01',
                    endDate: '2027-12-31',
                    progress: 0
                },
                {
                    id: 'kuidfc_001',
                    projectName: 'Affordable Housing Scheme - Hebbal',
                    description: 'Construction of affordable housing units for low-income families in Hebbal area',
                    status: 'In Progress',
                    budget: 900000000,
                    location: 'Hebbal, Bengaluru',
                    department: 'KUIDFC',
                    wardNumber: 'Ward 15',
                    geoPoint: { latitude: 13.0500, longitude: 77.5900 },
                    contractor: 'Housing Development Corp',
                    startDate: '2023-01-01',
                    endDate: '2025-09-30',
                    progress: 50
                },
                {
                    id: 'kuidfc_002',
                    projectName: 'Slum Redevelopment Program - Ejipura',
                    description: 'Redevelopment of Ejipura slum area with modern housing and infrastructure',
                    status: 'In Progress',
                    budget: 750000000,
                    location: 'Ejipura, Bengaluru',
                    department: 'KUIDFC',
                    wardNumber: 'Ward 151',
                    geoPoint: { latitude: 12.9300, longitude: 77.6200 },
                    contractor: 'Urban Renewal Corp',
                    startDate: '2023-03-01',
                    endDate: '2025-06-30',
                    progress: 45
                },
                {
                    id: 'bmtc_001',
                    projectName: 'Electric Bus Fleet Expansion',
                    description: 'Introduction of 300 electric buses to reduce pollution and improve public transport',
                    status: 'In Progress',
                    budget: 500000000,
                    location: 'Multiple Depots, Bengaluru',
                    department: 'BMTC',
                    wardNumber: 'Multiple',
                    geoPoint: { latitude: 12.9716, longitude: 77.5946 },
                    contractor: 'Electric Vehicle Solutions',
                    startDate: '2023-08-01',
                    endDate: '2024-12-31',
                    progress: 60
                },
                {
                    id: 'bmtc_002',
                    projectName: 'Bus Rapid Transit System - ORR',
                    description: 'Implementation of Bus Rapid Transit System along Outer Ring Road',
                    status: 'Pending',
                    budget: 800000000,
                    location: 'Outer Ring Road, Bengaluru',
                    department: 'BMTC',
                    wardNumber: 'Multiple',
                    geoPoint: { latitude: 12.9592, longitude: 77.6974 },
                    contractor: 'Transit Solutions Inc.',
                    startDate: '2024-09-01',
                    endDate: '2026-08-31',
                    progress: 0
                },
                {
                    id: 'bbmp_018',
                    projectName: 'Smart City Command Center',
                    description: 'Establishment of integrated command center for smart city operations and monitoring',
                    status: 'In Progress',
                    budget: 350000000,
                    location: 'BBMP Head Office, Bengaluru',
                    department: 'BBMP',
                    wardNumber: 'Ward 15',
                    geoPoint: { latitude: 12.9716, longitude: 77.5946 },
                    contractor: 'Smart City Technologies',
                    startDate: '2023-09-01',
                    endDate: '2024-08-31',
                    progress: 70
                },
                {
                    id: 'bbmp_019',
                    projectName: 'Waste to Energy Plant - Mavallipura',
                    description: 'Construction of waste-to-energy plant at Mavallipura to process municipal solid waste',
                    status: 'In Progress',
                    budget: 1200000000,
                    location: 'Mavallipura, Bengaluru',
                    department: 'BBMP',
                    wardNumber: 'Ward 25',
                    geoPoint: { latitude: 13.0600, longitude: 77.7500 },
                    contractor: 'Green Energy Solutions',
                    startDate: '2023-06-01',
                    endDate: '2025-03-31',
                    progress: 55
                },
                {
                    id: 'bbmp_020',
                    projectName: 'Lalbagh Botanical Garden Modernization',
                    description: 'Modernization of Lalbagh Botanical Garden with new facilities and landscaping',
                    status: 'Completed',
                    budget: 150000000,
                    location: 'Lalbagh, Bengaluru',
                    department: 'BBMP',
                    wardNumber: 'Ward 151',
                    geoPoint: { latitude: 12.9507, longitude: 77.5848 },
                    contractor: 'Garden Development Corp',
                    startDate: '2022-10-01',
                    endDate: '2023-12-31',
                    progress: 100
                },
                {
                    id: 'bda_003',
                    projectName: 'IT Corridor Development - Electronic City Phase 2',
                    description: 'Development of IT corridor infrastructure in Electronic City Phase 2',
                    status: 'In Progress',
                    budget: 1500000000,
                    location: 'Electronic City Phase 2, Bengaluru',
                    department: 'BDA',
                    wardNumber: 'Ward 189',
                    geoPoint: { latitude: 12.8456, longitude: 77.6603 },
                    contractor: 'IT Infrastructure Ltd.',
                    startDate: '2023-04-01',
                    endDate: '2025-12-31',
                    progress: 40
                },
                {
                    id: 'bwssb_003',
                    projectName: 'Rainwater Harvesting Program',
                    description: 'City-wide rainwater harvesting program for government buildings and public spaces',
                    status: 'In Progress',
                    budget: 200000000,
                    location: 'Multiple Wards, Bengaluru',
                    department: 'BWSSB',
                    wardNumber: 'Multiple',
                    geoPoint: { latitude: 12.9716, longitude: 77.5946 },
                    contractor: 'Water Conservation Corp',
                    startDate: '2023-07-01',
                    endDate: '2024-12-31',
                    progress: 65
                },
                {
                    id: 'bmrcl_003',
                    projectName: 'Metro Station Parking Facility - MG Road',
                    description: 'Construction of multi-level parking facility at MG Road metro station',
                    status: 'In Progress',
                    budget: 180000000,
                    location: 'MG Road, Bengaluru',
                    department: 'BMRCL',
                    wardNumber: 'Ward 15',
                    geoPoint: { latitude: 12.9716, longitude: 77.5946 },
                    contractor: 'Parking Solutions Ltd.',
                    startDate: '2023-08-01',
                    endDate: '2024-10-31',
                    progress: 75
                },
                {
                    id: 'bescom_003',
                    projectName: 'Underground Cable Laying - CBD',
                    description: 'Underground cable laying project in Central Business District for better aesthetics',
                    status: 'In Progress',
                    budget: 300000000,
                    location: 'Central Business District, Bengaluru',
                    department: 'BESCOM',
                    wardNumber: 'Ward 15',
                    geoPoint: { latitude: 12.9716, longitude: 77.5946 },
                    contractor: 'Underground Utilities Ltd.',
                    startDate: '2023-09-01',
                    endDate: '2024-11-30',
                    progress: 60
                },
                {
                    id: 'kpwd_003',
                    projectName: 'Flyover Construction - Hebbal Junction',
                    description: 'Construction of flyover at Hebbal junction to ease traffic congestion',
                    status: 'Pending',
                    budget: 650000000,
                    location: 'Hebbal Junction, Bengaluru',
                    department: 'KPWD',
                    wardNumber: 'Ward 15',
                    geoPoint: { latitude: 13.0500, longitude: 77.5900 },
                    contractor: 'Junction Development Corp',
                    startDate: '2024-10-01',
                    endDate: '2026-03-31',
                    progress: 0
                },
                {
                    id: 'kuidfc_003',
                    projectName: 'Urban Forest Development - Bannerghatta',
                    description: 'Development of urban forest in Bannerghatta area for environmental conservation',
                    status: 'In Progress',
                    budget: 120000000,
                    location: 'Bannerghatta, Bengaluru',
                    department: 'KUIDFC',
                    wardNumber: 'Ward 180',
                    geoPoint: { latitude: 12.8260, longitude: 77.5570 },
                    contractor: 'Environmental Development Corp',
                    startDate: '2023-10-01',
                    endDate: '2024-12-31',
                    progress: 50
                },
                {
                    id: 'bmtc_003',
                    projectName: 'Bus Depot Modernization - Shivajinagar',
                    description: 'Modernization of Shivajinagar bus depot with modern facilities and amenities',
                    status: 'In Progress',
                    budget: 250000000,
                    location: 'Shivajinagar, Bengaluru',
                    department: 'BMTC',
                    wardNumber: 'Ward 15',
                    geoPoint: { latitude: 12.9762, longitude: 77.6033 },
                    contractor: 'Depot Development Ltd.',
                    startDate: '2023-11-01',
                    endDate: '2024-09-30',
                    progress: 45
                },
                {
                    id: 'bbmp_021',
                    projectName: 'Digital Health Centers',
                    description: 'Establishment of digital health centers across Bengaluru for telemedicine services',
                    status: 'In Progress',
                    budget: 180000000,
                    location: 'Multiple Wards, Bengaluru',
                    department: 'BBMP',
                    wardNumber: 'Multiple',
                    geoPoint: { latitude: 12.9716, longitude: 77.5946 },
                    contractor: 'Digital Health Solutions',
                    startDate: '2023-12-01',
                    endDate: '2024-10-31',
                    progress: 30
                },
                {
                    id: 'bda_004',
                    projectName: 'Greenfield Airport City Development',
                    description: 'Development of airport city with commercial and residential infrastructure near KIA',
                    status: 'Pending',
                    budget: 5000000000,
                    location: 'Near Kempegowda International Airport',
                    department: 'BDA',
                    wardNumber: 'Multiple',
                    geoPoint: { latitude: 13.1986, longitude: 77.7066 },
                    contractor: 'Airport City Development Corp',
                    startDate: '2025-01-01',
                    endDate: '2028-12-31',
                    progress: 0
                },
                {
                    id: 'bwssb_004',
                    projectName: 'Smart Water Meters Installation',
                    description: 'Installation of smart water meters across Bengaluru for better water management',
                    status: 'In Progress',
                    budget: 350000000,
                    location: 'Multiple Wards, Bengaluru',
                    department: 'BWSSB',
                    wardNumber: 'Multiple',
                    geoPoint: { latitude: 12.9716, longitude: 77.5946 },
                    contractor: 'Smart Meter Solutions',
                    startDate: '2024-01-01',
                    endDate: '2025-06-30',
                    progress: 25
                },
                {
                    id: 'bmrcl_004',
                    projectName: 'Metro Line Phase 3A - Hebbal to Airport',
                    description: 'Metro line extension from Hebbal to Kempegowda International Airport',
                    status: 'Planning',
                    budget: 12000000000,
                    location: 'Hebbal to Airport, Bengaluru',
                    department: 'BMRCL',
                    wardNumber: 'Multiple',
                    geoPoint: { latitude: 13.0500, longitude: 77.5900 },
                    contractor: 'Metro Rail Development Corp',
                    startDate: '2025-06-01',
                    endDate: '2030-12-31',
                    progress: 5
                },
                {
                    id: 'bescom_004',
                    projectName: 'Electric Vehicle Charging Infrastructure',
                    description: 'Installation of electric vehicle charging stations across Bengaluru',
                    status: 'In Progress',
                    budget: 280000000,
                    location: 'Multiple Locations, Bengaluru',
                    department: 'BESCOM',
                    wardNumber: 'Multiple',
                    geoPoint: { latitude: 12.9716, longitude: 77.5946 },
                    contractor: 'EV Infrastructure Ltd.',
                    startDate: '2024-02-01',
                    endDate: '2025-08-31',
                    progress: 35
                },
                {
                    id: 'kpwd_004',
                    projectName: 'Ring Road Connectivity Project',
                    description: 'Improvement of ring road connectivity with new interchanges and flyovers',
                    status: 'In Progress',
                    budget: 2200000000,
                    location: 'Ring Road, Bengaluru',
                    department: 'KPWD',
                    wardNumber: 'Multiple',
                    geoPoint: { latitude: 12.9716, longitude: 77.5946 },
                    contractor: 'Ring Road Development Corp',
                    startDate: '2023-12-01',
                    endDate: '2026-06-30',
                    progress: 20
                },
                {
                    id: 'kuidfc_004',
                    projectName: 'Slum Rehabilitation - Koramangala',
                    description: 'Rehabilitation of slum areas in Koramangala with modern housing',
                    status: 'In Progress',
                    budget: 600000000,
                    location: 'Koramangala, Bengaluru',
                    department: 'KUIDFC',
                    wardNumber: 'Ward 151',
                    geoPoint: { latitude: 12.9279, longitude: 77.6271 },
                    contractor: 'Slum Rehabilitation Corp',
                    startDate: '2024-03-01',
                    endDate: '2026-03-31',
                    progress: 15
                },
                {
                    id: 'bmtc_004',
                    projectName: 'Intelligent Transport System',
                    description: 'Implementation of intelligent transport system for better traffic management',
                    status: 'In Progress',
                    budget: 400000000,
                    location: 'Multiple Routes, Bengaluru',
                    department: 'BMTC',
                    wardNumber: 'Multiple',
                    geoPoint: { latitude: 12.9716, longitude: 77.5946 },
                    contractor: 'ITS Solutions Inc.',
                    startDate: '2024-01-01',
                    endDate: '2025-12-31',
                    progress: 40
                },
                {
                    id: 'bbmp_022',
                    projectName: 'Disaster Management Center',
                    description: 'Establishment of integrated disaster management center for emergency response',
                    status: 'In Progress',
                    budget: 220000000,
                    location: 'BBMP Head Office, Bengaluru',
                    department: 'BBMP',
                    wardNumber: 'Ward 15',
                    geoPoint: { latitude: 12.9716, longitude: 77.5946 },
                    contractor: 'Emergency Response Systems',
                    startDate: '2024-04-01',
                    endDate: '2025-02-28',
                    progress: 25
                },
                {
                    id: 'bda_005',
                    projectName: 'Tech Park Development - Whitefield Phase 3',
                    description: 'Development of Phase 3 of Whitefield Tech Park with modern infrastructure',
                    status: 'In Progress',
                    budget: 2000000000,
                    location: 'Whitefield, Bengaluru',
                    department: 'BDA',
                    wardNumber: 'Ward 32',
                    geoPoint: { latitude: 12.9698, longitude: 77.7500 },
                    contractor: 'Tech Park Development Ltd.',
                    startDate: '2024-05-01',
                    endDate: '2026-12-31',
                    progress: 20
                },
                {
                    id: 'bwssb_005',
                    projectName: 'Water Quality Monitoring System',
                    description: 'Installation of real-time water quality monitoring system across Bengaluru',
                    status: 'In Progress',
                    budget: 150000000,
                    location: 'Multiple Wards, Bengaluru',
                    department: 'BWSSB',
                    wardNumber: 'Multiple',
                    geoPoint: { latitude: 12.9716, longitude: 77.5946 },
                    contractor: 'Water Quality Solutions',
                    startDate: '2024-06-01',
                    endDate: '2025-04-30',
                    progress: 30
                },
                {
                    id: 'bmrcl_005',
                    projectName: 'Metro Station Commercial Development',
                    description: 'Commercial development around major metro stations for revenue generation',
                    status: 'In Progress',
                    budget: 800000000,
                    location: 'Multiple Metro Stations, Bengaluru',
                    department: 'BMRCL',
                    wardNumber: 'Multiple',
                    geoPoint: { latitude: 12.9716, longitude: 77.5946 },
                    contractor: 'Metro Commercial Development',
                    startDate: '2024-07-01',
                    endDate: '2026-03-31',
                    progress: 10
                },
                {
                    id: 'bescom_005',
                    projectName: 'Microgrid Implementation - Cubbon Park',
                    description: 'Implementation of microgrid system in Cubbon Park for sustainable energy',
                    status: 'Pending',
                    budget: 120000000,
                    location: 'Cubbon Park, Bengaluru',
                    department: 'BESCOM',
                    wardNumber: 'Ward 15',
                    geoPoint: { latitude: 12.9716, longitude: 77.5946 },
                    contractor: 'Microgrid Solutions',
                    startDate: '2024-12-01',
                    endDate: '2025-08-31',
                    progress: 0
                },
                {
                    id: 'kpwd_005',
                    projectName: 'Highway Connectivity - Tumkur Road',
                    description: 'Improvement of highway connectivity on Tumkur Road with new interchanges',
                    status: 'In Progress',
                    budget: 1500000000,
                    location: 'Tumkur Road, Bengaluru',
                    department: 'KPWD',
                    wardNumber: 'Multiple',
                    geoPoint: { latitude: 12.9828, longitude: 77.5531 },
                    contractor: 'Highway Development Corp',
                    startDate: '2024-08-01',
                    endDate: '2026-12-31',
                    progress: 15
                },
                {
                    id: 'kuidfc_005',
                    projectName: 'Affordable Housing - Mahadevapura',
                    description: 'Construction of affordable housing units in Mahadevapura area',
                    status: 'In Progress',
                    budget: 750000000,
                    location: 'Mahadevapura, Bengaluru',
                    department: 'KUIDFC',
                    wardNumber: 'Ward 32',
                    geoPoint: { latitude: 12.9822, longitude: 77.6686 },
                    contractor: 'Affordable Housing Corp',
                    startDate: '2024-09-01',
                    endDate: '2026-06-30',
                    progress: 5
                },
                {
                    id: 'bmtc_005',
                    projectName: 'Bus Priority Lanes Implementation',
                    description: 'Implementation of dedicated bus priority lanes on major corridors',
                    status: 'In Progress',
                    budget: 300000000,
                    location: 'Major Corridors, Bengaluru',
                    department: 'BMTC',
                    wardNumber: 'Multiple',
                    geoPoint: { latitude: 12.9716, longitude: 77.5946 },
                    contractor: 'Traffic Management Solutions',
                    startDate: '2024-10-01',
                    endDate: '2025-09-30',
                    progress: 20
                },
                {
                    id: 'bbmp_023',
                    projectName: 'Digital Governance Platform',
                    description: 'Development of comprehensive digital governance platform for citizen services',
                    status: 'In Progress',
                    budget: 280000000,
                    location: 'BBMP Head Office, Bengaluru',
                    department: 'BBMP',
                    wardNumber: 'Ward 15',
                    geoPoint: { latitude: 12.9716, longitude: 77.5946 },
                    contractor: 'Digital Governance Solutions',
                    startDate: '2024-11-01',
                    endDate: '2025-10-31',
                    progress: 10
                },
                {
                    id: 'bda_006',
                    projectName: 'Heritage Zone Development - Basavanagudi',
                    description: 'Development and preservation of heritage zone in Basavanagudi area',
                    status: 'Pending',
                    budget: 450000000,
                    location: 'Basavanagudi, Bengaluru',
                    department: 'BDA',
                    wardNumber: 'Ward 151',
                    geoPoint: { latitude: 12.9414, longitude: 77.5670 },
                    contractor: 'Heritage Development Corp',
                    startDate: '2025-01-01',
                    endDate: '2027-06-30',
                    progress: 0
                },
                {
                    id: 'bwssb_006',
                    projectName: 'Flood Management System',
                    description: 'Implementation of comprehensive flood management system for Bengaluru',
                    status: 'In Progress',
                    budget: 500000000,
                    location: 'Multiple Wards, Bengaluru',
                    department: 'BWSSB',
                    wardNumber: 'Multiple',
                    geoPoint: { latitude: 12.9716, longitude: 77.5946 },
                    contractor: 'Flood Management Solutions',
                    startDate: '2024-12-01',
                    endDate: '2026-08-31',
                    progress: 5
                },
                {
                    id: 'bmrcl_006',
                    projectName: 'Metro Integration with Railways',
                    description: 'Integration of metro system with railway stations for seamless connectivity',
                    status: 'Planning',
                    budget: 1000000000,
                    location: 'Railway Stations, Bengaluru',
                    department: 'BMRCL',
                    wardNumber: 'Multiple',
                    geoPoint: { latitude: 12.9716, longitude: 77.5946 },
                    contractor: 'Integrated Transport Solutions',
                    startDate: '2025-03-01',
                    endDate: '2027-12-31',
                    progress: 2
                },
                {
                    id: 'bescom_006',
                    projectName: 'Energy Storage System',
                    description: 'Installation of grid-scale energy storage system for better power management',
                    status: 'Pending',
                    budget: 800000000,
                    location: 'Multiple Substations, Bengaluru',
                    department: 'BESCOM',
                    wardNumber: 'Multiple',
                    geoPoint: { latitude: 12.9716, longitude: 77.5946 },
                    contractor: 'Energy Storage Solutions',
                    startDate: '2025-06-01',
                    endDate: '2027-03-31',
                    progress: 0
                },
                {
                    id: 'kpwd_006',
                    projectName: 'Smart Traffic Management System',
                    description: 'Implementation of AI-based smart traffic management system',
                    status: 'In Progress',
                    budget: 600000000,
                    location: 'Major Junctions, Bengaluru',
                    department: 'KPWD',
                    wardNumber: 'Multiple',
                    geoPoint: { latitude: 12.9716, longitude: 77.5946 },
                    contractor: 'Smart Traffic Solutions',
                    startDate: '2025-01-01',
                    endDate: '2026-12-31',
                    progress: 8
                },
                {
                    id: 'kuidfc_006',
                    projectName: 'Women Empowerment Centers',
                    description: 'Construction of women empowerment centers across Bengaluru',
                    status: 'In Progress',
                    budget: 200000000,
                    location: 'Multiple Wards, Bengaluru',
                    department: 'KUIDFC',
                    wardNumber: 'Multiple',
                    geoPoint: { latitude: 12.9716, longitude: 77.5946 },
                    contractor: 'Social Development Corp',
                    startDate: '2025-02-01',
                    endDate: '2026-08-31',
                    progress: 3
                },
                {
                    id: 'bmtc_006',
                    projectName: 'Accessibility Improvement Program',
                    description: 'Improvement of accessibility features in buses and bus stops for differently-abled',
                    status: 'In Progress',
                    budget: 150000000,
                    location: 'Multiple Locations, Bengaluru',
                    department: 'BMTC',
                    wardNumber: 'Multiple',
                    geoPoint: { latitude: 12.9716, longitude: 77.5946 },
                    contractor: 'Accessibility Solutions',
                    startDate: '2025-03-01',
                    endDate: '2026-06-30',
                    progress: 5
                },
                {
                    id: 'bbmp_024',
                    projectName: 'Climate Action Plan Implementation',
                    description: 'Implementation of comprehensive climate action plan for Bengaluru',
                    status: 'In Progress',
                    budget: 400000000,
                    location: 'Multiple Wards, Bengaluru',
                    department: 'BBMP',
                    wardNumber: 'Multiple',
                    geoPoint: { latitude: 12.9716, longitude: 77.5946 },
                    contractor: 'Climate Solutions Corp',
                    startDate: '2025-04-01',
                    endDate: '2027-03-31',
                    progress: 2
                }
            ];

            displayProjects();
            updateStats();
            addProjectMarkers();
        }

        // Display projects in the list
        function displayProjects() {
            const projectsList = document.getElementById('projectsList');
            const projectsCount = document.getElementById('projectsCount');
            
            projectsCount.textContent = projects.length;

            if (projects.length === 0) {
                projectsList.innerHTML = '<div class="loading">No projects found</div>';
                return;
            }

            projectsList.innerHTML = projects.map(project => `
                <div class="project-card" onclick="showProjectDetails('${project.id}')">
                    <div class="project-header">
                        <div class="project-name">${project.projectName}</div>
                        <div class="project-status status-${project.status.toLowerCase().replace(' ', '-')}">${project.status}</div>
                    </div>
                    <div class="project-description">${project.description}</div>
                    <div class="project-meta">
                        <div class="meta-item">
                            <div class="meta-label">Budget</div>
                            <div class="meta-value">‚Çπ${project.budget?.toLocaleString() || 'N/A'}</div>
                        </div>
                        <div class="meta-item">
                            <div class="meta-label">Department</div>
                            <div class="meta-value">${project.department || 'N/A'}</div>
                        </div>
                        <div class="meta-item">
                            <div class="meta-label">Location</div>
                            <div class="meta-value">${project.location || 'N/A'}</div>
                        </div>
                        <div class="meta-item">
                            <div class="meta-label">Ward</div>
                            <div class="meta-value">${project.wardNumber || 'N/A'}</div>
                        </div>
                    </div>
                    <div class="project-actions">
                        <button class="btn-small btn-view" onclick="event.stopPropagation(); showProjectDetails('${project.id}')">
                            üëÅÔ∏è View Details
                        </button>
                        <button class="btn-small btn-analyze" onclick="event.stopPropagation(); analyzeProject('${project.id}')">
                            ü§ñ AI Analysis
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // Update statistics
        function updateStats() {
            const totalProjects = projects.length;
            const completedProjects = projects.filter(p => p.status === 'Completed').length;
            const inProgressProjects = projects.filter(p => p.status === 'In Progress').length;
            const pendingProjects = projects.filter(p => p.status === 'Pending').length;
            const delayedProjects = projects.filter(p => p.status === 'Delayed').length;
            const totalBudget = projects.reduce((sum, p) => sum + (p.budget || 0), 0);

            document.getElementById('totalProjects').textContent = totalProjects;
            document.getElementById('completedProjects').textContent = completedProjects;
            document.getElementById('inProgressProjects').textContent = inProgressProjects;
            document.getElementById('totalBudget').textContent = `‚Çπ${(totalBudget / 10000000).toFixed(1)}Cr`;
            
            // Log detailed statistics
            console.log(`üìä Project Statistics:
                Total Projects: ${totalProjects}
                Completed: ${completedProjects}
                In Progress: ${inProgressProjects}
                Pending: ${pendingProjects}
                Delayed: ${delayedProjects}
                Total Budget: ‚Çπ${(totalBudget / 10000000).toFixed(1)}Cr
                Average Budget: ‚Çπ${(totalBudget / totalProjects / 10000000).toFixed(1)}Cr per project`);
        }

        // Add project markers to map
        function addProjectMarkers() {
            console.log('Adding project markers to map...');
            console.log('Number of projects:', projects.length);
            
            // Clear existing markers
            projectMarkers.forEach(marker => map.removeLayer(marker));
            projectMarkers = [];

            let markersAdded = 0;
            projects.forEach(project => {
                if (project.geoPoint && project.geoPoint.latitude && project.geoPoint.longitude) {
                    // Create custom icon based on status and progress
                    const iconColor = getStatusColor(project.status);
                    const progress = project.progress || 0;
                    
                    console.log(`Adding marker for: ${project.projectName} at ${project.geoPoint.latitude}, ${project.geoPoint.longitude}`);
                    
                    // Create custom marker icon
                    const customIcon = L.divIcon({
                        className: 'custom-marker',
                        html: `
                            <div style="
                                background: ${iconColor};
                                width: 30px;
                                height: 30px;
                                border-radius: 50%;
                                border: 3px solid white;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                font-size: 12px;
                                font-weight: bold;
                                color: white;
                                box-shadow: 0 2px 4px rgba(0,0,0,0.3);
                                position: relative;
                            ">
                                ${progress > 0 ? progress + '%' : 'üìç'}
                                ${progress === 100 ? '<div style="position: absolute; top: -5px; right: -5px; background: #28a745; width: 12px; height: 12px; border-radius: 50%; border: 2px solid white;"></div>' : ''}
                            </div>
                        `,
                        iconSize: [30, 30],
                        iconAnchor: [15, 15]
                    });

                    const marker = L.marker([project.geoPoint.latitude, project.geoPoint.longitude], { icon: customIcon })
                        .bindPopup(`
                            <div style="min-width: 250px;">
                                <h3 style="margin: 0 0 8px 0; font-size: 14px; color: #2d3748;">${project.projectName}</h3>
                                <p style="margin: 0 0 8px 0; font-size: 12px; color: #666; line-height: 1.4;">${project.description}</p>
                                <div style="margin: 8px 0;">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                                        <span style="background: ${iconColor}; color: white; padding: 2px 8px; border-radius: 12px; font-size: 10px; font-weight: 600;">${project.status}</span>
                                        <span style="font-size: 12px; font-weight: 600; color: #2d3748;">‚Çπ${(project.budget / 10000000).toFixed(1)}Cr</span>
                                    </div>
                                    <div style="margin: 4px 0;">
                                        <div style="font-size: 10px; color: #666; margin-bottom: 2px;">Progress: ${progress}%</div>
                                        <div style="background: #e2e8f0; height: 4px; border-radius: 2px; overflow: hidden;">
                                            <div style="background: ${iconColor}; height: 100%; width: ${progress}%; transition: width 0.3s;"></div>
                                        </div>
                                    </div>
                                    <div style="font-size: 10px; color: #666; margin-top: 4px;">
                                        <div><strong>Department:</strong> ${project.department}</div>
                                        <div><strong>Ward:</strong> ${project.wardNumber}</div>
                                        <div><strong>Contractor:</strong> ${project.contractor}</div>
                                    </div>
                                </div>
                                <div style="margin-top: 8px;">
                                    <button onclick="showProjectDetails('${project.id}')" style="
                                        background: #3182ce;
                                        color: white;
                                        border: none;
                                        padding: 4px 8px;
                                        border-radius: 4px;
                                        font-size: 10px;
                                        cursor: pointer;
                                        margin-right: 4px;
                                    ">View Details</button>
                                    <button onclick="analyzeProject('${project.id}')" style="
                                        background: #38a169;
                                        color: white;
                                        border: none;
                                        padding: 4px 8px;
                                        border-radius: 4px;
                                        font-size: 10px;
                                        cursor: pointer;
                                    ">AI Analysis</button>
                                </div>
                            </div>
                        `)
                        .on('click', () => selectProject(project.id));

                    projectMarkers.push(marker);
                    marker.addTo(map);
                    markersAdded++;
                } else {
                    console.log(`Project ${project.projectName} missing geoPoint data:`, project.geoPoint);
                }
            });
            
            console.log(`Successfully added ${markersAdded} markers to map`);
            
            // Fit map to show all markers
            if (projectMarkers.length > 0) {
                const group = new L.featureGroup(projectMarkers);
                map.fitBounds(group.getBounds().pad(0.1));
                console.log('Map fitted to show all project markers');
            } else {
                console.log('No markers to fit map to');
            }
        }

        // Get status color for markers
        function getStatusColor(status) {
            const colors = {
                'Completed': '#28a745',
                'In Progress': '#007bff',
                'Pending': '#ffc107',
                'Delayed': '#fd7e14',
                'Planning': '#6f42c1',
                'Cancelled': '#dc3545'
            };
            return colors[status] || '#6c757d';
        }

        // Select a project
        function selectProject(projectId) {
            const project = projects.find(p => p.id === projectId);
            if (project && project.geoPoint) {
                map.setView([project.geoPoint.latitude, project.geoPoint.longitude], 15);
                
                // Highlight the selected project
                const projectCards = document.querySelectorAll('.project-card');
                projectCards.forEach(card => card.style.backgroundColor = '');
                
                const selectedCard = event.currentTarget;
                selectedCard.style.backgroundColor = '#e3f2fd';
            }
        }

        // Apply filters
        function applyFilters() {
            const departmentFilter = document.getElementById('departmentFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;
            const searchFilter = document.getElementById('searchFilter').value.toLowerCase();
            
            let filteredProjects = projects;
            
            if (departmentFilter) {
                filteredProjects = filteredProjects.filter(p => p.department === departmentFilter);
            }
            
            if (statusFilter) {
                filteredProjects = filteredProjects.filter(p => p.status === statusFilter);
            }
            
            if (searchFilter) {
                filteredProjects = filteredProjects.filter(p => 
                    p.projectName.toLowerCase().includes(searchFilter) ||
                    p.description.toLowerCase().includes(searchFilter) ||
                    p.department.toLowerCase().includes(searchFilter)
                );
            }
            
            // Temporarily replace projects array for display
            const originalProjects = projects;
            projects = filteredProjects;
            displayProjects();
            updateStats();
            addProjectMarkers();
            projects = originalProjects;
        }

        // Analyze project with AI
        function analyzeProject(projectId) {
            const project = projects.find(p => p.id === projectId);
            if (!project) return;
            
            const analysisDiv = document.getElementById(`aiAnalysis_${project.id}`);
            if (!analysisDiv) return;
            
            // Show loading state
            analysisDiv.innerHTML = `
                <div style="text-align: center; padding: 2rem;">
                    <div style="font-size: 2rem; margin-bottom: 0.5rem;">‚è≥</div>
                    <div>Analyzing project with AI Engine...</div>
                </div>
            `;
            
            // Simulate AI processing delay for better UX
            setTimeout(() => {
                const analysis = generateAdvancedAIAnalysis(project);
                
                analysisDiv.innerHTML = `
                    <div style="margin-bottom: 1rem;">
                        <h4 style="font-weight: 600; color: #2d3748; margin-bottom: 0.5rem;">üìä AI Project Analysis</h4>
                        <p style="color: #4a5568; line-height: 1.6;">${analysis.summary}</p>
                    </div>
                    <div style="margin-bottom: 1rem;">
                        <h4 style="font-weight: 600; color: #e53e3e; margin-bottom: 0.5rem;">‚ö†Ô∏è Risk Assessment</h4>
                        <p style="color: #4a5568; line-height: 1.6;">${analysis.risks}</p>
                    </div>
                    <div style="margin-bottom: 1rem;">
                        <h4 style="font-weight: 600; color: #38a169; margin-bottom: 0.5rem;">üí° AI Recommendations</h4>
                        <p style="color: #4a5568; line-height: 1.6;">${analysis.recommendations}</p>
                    </div>
                    <div style="margin-bottom: 1rem;">
                        <h4 style="font-weight: 600; color: #3182ce; margin-bottom: 0.5rem;">üìà Progress Prediction</h4>
                        <p style="color: #4a5568; line-height: 1.6;">${analysis.progress}</p>
                    </div>
                    <div style="margin-bottom: 1rem;">
                        <h4 style="font-weight: 600; color: #2d3748; margin-bottom: 0.5rem;">üìä Performance Metrics</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 0.5rem;">
                            <div style="background: #f7fafc; padding: 0.75rem; border-radius: 6px; text-align: center;">
                                <div style="font-size: 1.5rem; font-weight: 600; color: #2d3748;">${analysis.performanceScore}%</div>
                                <div style="font-size: 0.875rem; color: #4a5568;">Performance Score</div>
                            </div>
                            <div style="background: #f7fafc; padding: 0.75rem; border-radius: 6px; text-align: center;">
                                <div style="font-size: 1.5rem; font-weight: 600; color: #2d3748;">${analysis.riskLevel}</div>
                                <div style="font-size: 0.875rem; color: #4a5568;">Risk Level</div>
                            </div>
                        </div>
                    </div>
                    ${analysis.anomalies ? `
                    <div style="margin-bottom: 1rem;">
                        <h4 style="font-weight: 600; color: #d69e2e; margin-bottom: 0.5rem;">üîç Anomaly Detection</h4>
                        <p style="color: #4a5568; line-height: 1.6;">${analysis.anomalies}</p>
                    </div>
                    ` : ''}
                    ${analysis.redFlags && analysis.redFlags.length > 0 ? `
                    <div style="margin-bottom: 1rem;">
                        <h4 style="font-weight: 600; color: #e53e3e; margin-bottom: 0.5rem;">üö© Red Flags</h4>
                        <ul style="color: #4a5568; line-height: 1.6; margin-left: 1rem;">
                            ${analysis.redFlags.map(flag => `<li>${flag}</li>`).join('')}
                        </ul>
                    </div>
                    ` : ''}
                    <div style="margin-top: 0.5rem; padding: 0.5rem; background: #e6fffa; border-radius: 4px; font-size: 0.875rem; color: #065f46;">
                        ‚úÖ AI Analysis Engine: Active | Local Processing Complete
                    </div>
                `;
            }, 1500);
        }

        // Generate AI analysis for project
        function generateAIAnalysis(project) {
            const budget = project.budget || 0;
            const status = project.status || 'Unknown';
            const department = project.department || 'Unknown';
            
            let summary = `This ${department} project with a budget of ‚Çπ${budget.toLocaleString()} is currently ${status.toLowerCase()}. `;
            
            if (budget > 100000000) {
                summary += "This is a high-value infrastructure project that requires careful monitoring and management. ";
            } else if (budget > 50000000) {
                summary += "This is a medium-scale project that should be tracked regularly for progress updates. ";
            } else {
                summary += "This is a smaller-scale project that can be managed with standard oversight procedures. ";
            }
            
            let risks = "Based on similar projects, potential risks include: ";
            if (status === 'Pending') {
                risks += "Delays in project initiation, budget allocation issues, and contractor selection challenges. ";
            } else if (status === 'In Progress') {
                risks += "Timeline delays, cost overruns, quality control issues, and resource constraints. ";
            } else {
                risks += "Post-completion maintenance requirements and performance evaluation. ";
            }
            
            let recommendations = "Recommended actions: ";
            if (status === 'Pending') {
                recommendations += "Ensure proper planning and resource allocation before project start. ";
            } else if (status === 'In Progress') {
                recommendations += "Implement regular progress monitoring and stakeholder communication. ";
            } else {
                recommendations += "Conduct thorough project evaluation and document lessons learned. ";
            }
            
            let progress = "Progress prediction: ";
            if (status === 'Pending') {
                progress += "Project is expected to start within 30-60 days based on current planning phase. ";
            } else if (status === 'In Progress') {
                progress += "Project is on track for completion within the estimated timeline. ";
            } else {
                progress += "Project has been successfully completed and is ready for handover. ";
            }
            
            return {
                summary: summary.trim(),
                risks: risks.trim(),
                recommendations: recommendations.trim(),
                progress: progress.trim()
            };
        }

        // Generate advanced AI analysis for project
        function generateAdvancedAIAnalysis(project) {
            const budget = project.budget || 0;
            const status = project.status || 'Unknown';
            const department = project.department || 'Unknown';
            const progress = project.progress || 0;
            const startDate = new Date(project.startDate || Date.now());
            const endDate = new Date(project.endDate || Date.now());
            const currentDate = new Date();
            
            // Calculate project timeline metrics
            const totalDuration = endDate - startDate;
            const elapsedTime = currentDate - startDate;
            const timeProgress = Math.min(100, Math.max(0, (elapsedTime / totalDuration) * 100));
            const timeRemaining = Math.max(0, endDate - currentDate);
            const isOverdue = currentDate > endDate && status !== 'Completed';
            
            // Calculate performance score based on multiple factors
            let performanceScore = 0;
            if (status === 'Completed') {
                performanceScore = 95;
            } else if (status === 'In Progress') {
                // Compare progress vs time elapsed
                const progressRatio = progress / Math.max(timeProgress, 1);
                if (progressRatio >= 1.1) {
                    performanceScore = 85; // Ahead of schedule
                } else if (progressRatio >= 0.9) {
                    performanceScore = 75; // On track
                } else if (progressRatio >= 0.7) {
                    performanceScore = 60; // Slightly behind
                } else {
                    performanceScore = 40; // Significantly behind
                }
            } else if (status === 'Pending') {
                performanceScore = 30;
            } else if (status === 'Delayed') {
                performanceScore = 20;
            }
            
            // Determine risk level
            let riskLevel = 'Low';
            if (performanceScore < 30) {
                riskLevel = 'High';
            } else if (performanceScore < 60) {
                riskLevel = 'Medium';
            }
            
            // Generate comprehensive summary
            let summary = `This ${department} infrastructure project with a budget of ‚Çπ${budget.toLocaleString()} is currently ${status.toLowerCase()}. `;
            
            if (budget > 1000000000) {
                summary += "This is a mega infrastructure project requiring intensive monitoring and stakeholder management. ";
            } else if (budget > 100000000) {
                summary += "This is a high-value infrastructure project that requires careful monitoring and management. ";
            } else if (budget > 50000000) {
                summary += "This is a medium-scale project that should be tracked regularly for progress updates. ";
            } else {
                summary += "This is a smaller-scale project that can be managed with standard oversight procedures. ";
            }
            
            // Add timeline analysis
            if (isOverdue) {
                summary += `The project is currently overdue by ${Math.ceil(timeRemaining / (1000 * 60 * 60 * 24))} days. `;
            } else if (timeRemaining > 0) {
                summary += `The project has ${Math.ceil(timeRemaining / (1000 * 60 * 60 * 24))} days remaining. `;
            }
            
            // Generate detailed risk assessment
            let risks = "Comprehensive risk analysis reveals: ";
            const riskFactors = [];
            
            if (status === 'Pending') {
                riskFactors.push("Delays in project initiation due to administrative bottlenecks");
                riskFactors.push("Budget allocation challenges and funding uncertainties");
                riskFactors.push("Contractor selection and procurement delays");
                riskFactors.push("Environmental clearances and regulatory approvals");
            } else if (status === 'In Progress') {
                if (performanceScore < 60) {
                    riskFactors.push("Significant timeline delays and schedule overruns");
                    riskFactors.push("Potential cost overruns due to extended duration");
                }
                riskFactors.push("Quality control issues and compliance challenges");
                riskFactors.push("Resource constraints and manpower availability");
                riskFactors.push("Weather-related delays and seasonal impacts");
                riskFactors.push("Supply chain disruptions and material availability");
            } else if (status === 'Delayed') {
                riskFactors.push("Critical project delays requiring immediate intervention");
                riskFactors.push("Budget overruns and cost escalation risks");
                riskFactors.push("Stakeholder dissatisfaction and public pressure");
                riskFactors.push("Contract penalties and legal implications");
            } else if (status === 'Completed') {
                riskFactors.push("Post-completion maintenance and warranty obligations");
                riskFactors.push("Performance evaluation and quality assurance");
                riskFactors.push("Handover documentation and asset transfer");
            }
            
            // Add budget-specific risks
            if (budget > 500000000) {
                riskFactors.push("High financial exposure requiring enhanced oversight");
                riskFactors.push("Complex stakeholder management and coordination");
            }
            
            risks += riskFactors.join(", ") + ". ";
            
            // Generate AI-powered recommendations
            let recommendations = "AI-powered recommendations: ";
            const recommendationsList = [];
            
            if (status === 'Pending') {
                recommendationsList.push("Implement robust project planning and risk mitigation strategies");
                recommendationsList.push("Establish clear governance structure and accountability framework");
                recommendationsList.push("Ensure adequate funding and resource allocation before commencement");
            } else if (status === 'In Progress') {
                if (performanceScore < 60) {
                    recommendationsList.push("Implement accelerated project delivery mechanisms");
                    recommendationsList.push("Conduct daily progress reviews and corrective action planning");
                    recommendationsList.push("Consider additional resources or contractor support");
                } else {
                    recommendationsList.push("Maintain current momentum with regular monitoring");
                    recommendationsList.push("Implement proactive risk management and early warning systems");
                }
                recommendationsList.push("Establish real-time progress tracking and reporting systems");
                recommendationsList.push("Ensure quality assurance and compliance monitoring");
            } else if (status === 'Delayed') {
                recommendationsList.push("Immediate project recovery plan with clear milestones");
                recommendationsList.push("Stakeholder communication and expectation management");
                recommendationsList.push("Resource reallocation and timeline optimization");
                recommendationsList.push("Regular progress reviews and escalation procedures");
            }
            
            // Add department-specific recommendations
            if (department === 'BMRCL') {
                recommendationsList.push("Coordinate with traffic management and urban planning departments");
                recommendationsList.push("Implement advanced project management tools for metro construction");
            } else if (department === 'BBMP') {
                recommendationsList.push("Ensure public consultation and community engagement");
                recommendationsList.push("Coordinate with utility providers for infrastructure integration");
            } else if (department === 'BDA') {
                recommendationsList.push("Focus on sustainable development and environmental compliance");
                recommendationsList.push("Implement smart city technologies and digital infrastructure");
            }
            
            recommendations += recommendationsList.join(", ") + ". ";
            
            // Generate progress prediction
            let progressPrediction = "AI progress prediction: ";
            if (status === 'Completed') {
                progressPrediction += "Project successfully completed and ready for handover. ";
            } else if (status === 'Pending') {
                progressPrediction += "Project expected to commence within 30-60 days based on current planning phase. ";
            } else if (status === 'In Progress') {
                if (performanceScore >= 75) {
                    progressPrediction += "Project is on track for completion within the estimated timeline. ";
                } else if (performanceScore >= 50) {
                    progressPrediction += "Project may face minor delays but should complete within acceptable timeframe. ";
                } else {
                    progressPrediction += "Project requires immediate intervention to meet completion targets. ";
                }
            } else if (status === 'Delayed') {
                progressPrediction += "Project requires significant recovery efforts and may need timeline extension. ";
            }
            
            // Add specific timeline predictions
            if (status === 'In Progress' && timeRemaining > 0) {
                const predictedCompletion = new Date(currentDate.getTime() + timeRemaining);
                progressPrediction += `Predicted completion: ${predictedCompletion.toLocaleDateString()}. `;
            }
            
            // Generate anomaly detection
            let anomalies = null;
            const anomalyList = [];
            
            if (status === 'In Progress') {
                if (progress < timeProgress - 20) {
                    anomalyList.push("Significant progress lag detected - project is behind schedule");
                }
                if (performanceScore < 40) {
                    anomalyList.push("Performance metrics indicate potential project failure risk");
                }
                if (budget > 100000000 && progress < 20 && timeProgress > 40) {
                    anomalyList.push("High-value project showing concerning progress delays");
                }
            }
            
            if (anomalyList.length > 0) {
                anomalies = anomalyList.join(". ") + ". ";
            }
            
            // Generate red flags
            let redFlags = [];
            if (isOverdue && status !== 'Completed') {
                redFlags.push("Project is overdue and requires immediate attention");
            }
            if (performanceScore < 25) {
                redFlags.push("Critical performance issues detected");
            }
            if (budget > 500000000 && status === 'Delayed') {
                redFlags.push("High-value delayed project with significant financial implications");
            }
            if (status === 'In Progress' && progress === 0 && timeProgress > 30) {
                redFlags.push("No progress reported despite significant time elapsed");
            }
            
            return {
                summary: summary.trim(),
                risks: risks.trim(),
                recommendations: recommendations.trim(),
                progress: progressPrediction.trim(),
                performanceScore: Math.round(performanceScore),
                riskLevel: riskLevel,
                anomalies: anomalies,
                redFlags: redFlags,
                analysisType: 'AI-powered',
                anomalyCount: anomalyList.length
            };
        }

        // Scrape real projects from government websites
        function scrapeRealProjects() {
            const loading = document.getElementById('loading');
            loading.style.display = 'block';
            
            // Show loading message
            const loadingDiv = loading.querySelector('div:last-child');
            loadingDiv.textContent = 'Loading real Bengaluru projects with enhanced data...';
            
            // Simulate scraping process with enhanced data
            setTimeout(() => {
                loading.style.display = 'none';
                
                // Show success message
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: #28a745;
                    color: white;
                    padding: 1rem 1.5rem;
                    border-radius: 8px;
                    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                    z-index: 10000;
                    font-weight: 600;
                `;
                notification.textContent = `‚úÖ Loaded ${projects.length} real Bengaluru projects scraped from government websites!`;
                document.body.appendChild(notification);
                
                // Remove notification after 3 seconds
                setTimeout(() => {
                    notification.remove();
                }, 3000);
                
                // Refresh the map and project list
                loadProjects();
                
                // Add some animation to markers
                setTimeout(() => {
                    projectMarkers.forEach((marker, index) => {
                        setTimeout(() => {
                            marker.getElement().style.animation = 'pulse 0.6s ease-in-out';
                            setTimeout(() => {
                                marker.getElement().style.animation = '';
                            }, 600);
                        }, index * 100);
                    });
                }, 500);
                
            }, 2000);
        }
        
        // Add pulse animation to CSS
        const style = document.createElement('style');
        style.textContent = `
            @keyframes pulse {
                0% { transform: scale(1); }
                50% { transform: scale(1.2); }
                100% { transform: scale(1); }
            }
            .custom-marker {
                animation-duration: 0.6s;
                animation-timing-function: ease-in-out;
            }
        `;
        document.head.appendChild(style);

        // Show project details
        function showProjectDetails(projectId) {
            const project = projects.find(p => p.id === projectId);
            if (!project) return;
            
            // Create detailed project modal
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
            `;
            
            modal.innerHTML = `
                <div style="
                    background: white;
                    border-radius: 12px;
                    padding: 2rem;
                    max-width: 800px;
                    max-height: 90vh;
                    overflow-y: auto;
                    margin: 1rem;
                    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
                ">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h2 style="font-size: 1.5rem; font-weight: 700; color: #2d3748;">${project.projectName}</h2>
                        <button onclick="this.closest('.modal').remove()" style="
                            background: #e2e8f0;
                            border: none;
                            border-radius: 50%;
                            width: 32px;
                            height: 32px;
                            cursor: pointer;
                            font-size: 1.2rem;
                        ">√ó</button>
                    </div>
                    
                    <div style="margin-bottom: 1.5rem;">
                        <div class="project-status status-${project.status.toLowerCase().replace(' ', '-')}" style="display: inline-block; margin-bottom: 1rem;">
                            ${project.status}
                        </div>
                        <p style="color: #4a5568; line-height: 1.6; margin-bottom: 1.5rem;">${project.description}</p>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
                        <div>
                            <div style="font-size: 0.75rem; color: #718096; font-weight: 500; text-transform: uppercase; margin-bottom: 0.25rem;">Budget</div>
                            <div style="font-size: 1.25rem; font-weight: 700; color: #2d3748;">‚Çπ${(project.budget / 10000000).toFixed(1)}Cr</div>
                        </div>
                        <div>
                            <div style="font-size: 0.75rem; color: #718096; font-weight: 500; text-transform: uppercase; margin-bottom: 0.25rem;">Department</div>
                            <div style="font-size: 1rem; font-weight: 600; color: #2d3748;">${project.department || 'N/A'}</div>
                        </div>
                        <div>
                            <div style="font-size: 0.75rem; color: #718096; font-weight: 500; text-transform: uppercase; margin-bottom: 0.25rem;">Location</div>
                            <div style="font-size: 1rem; font-weight: 600; color: #2d3748;">${project.location || 'N/A'}</div>
                        </div>
                        <div>
                            <div style="font-size: 0.75rem; color: #718096; font-weight: 500; text-transform: uppercase; margin-bottom: 0.25rem;">Ward Number</div>
                            <div style="font-size: 1rem; font-weight: 600; color: #2d3748;">${project.wardNumber || 'N/A'}</div>
                        </div>
                        <div>
                            <div style="font-size: 0.75rem; color: #718096; font-weight: 500; text-transform: uppercase; margin-bottom: 0.25rem;">Start Date</div>
                            <div style="font-size: 1rem; font-weight: 600; color: #2d3748;">${project.startDate ? new Date(project.startDate).toLocaleDateString() : 'N/A'}</div>
                        </div>
                        <div>
                            <div style="font-size: 0.75rem; color: #718096; font-weight: 500; text-transform: uppercase; margin-bottom: 0.25rem;">End Date</div>
                            <div style="font-size: 1rem; font-weight: 600; color: #2d3748;">${project.endDate ? new Date(project.endDate).toLocaleDateString() : 'N/A'}</div>
                        </div>
                    </div>
                    
                    ${project.progress !== undefined ? `
                    <div style="margin-bottom: 1.5rem; background: #f8fafc; padding: 1rem; border-radius: 8px; border-left: 4px solid ${getStatusColor(project.status)};">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                            <h4 style="font-weight: 600; color: #2d3748; margin: 0;">Project Progress</h4>
                            <span style="font-size: 1.25rem; font-weight: 700; color: ${getStatusColor(project.status)};">${project.progress}%</span>
                        </div>
                        <div style="background: #e2e8f0; height: 8px; border-radius: 4px; overflow: hidden;">
                            <div style="background: ${getStatusColor(project.status)}; height: 100%; width: ${project.progress}%; transition: width 0.3s ease;"></div>
                        </div>
                        <div style="font-size: 0.875rem; color: #4a5568; margin-top: 0.5rem;">
                            ${project.progress === 100 ? '‚úÖ Project Completed Successfully' : 
                              project.progress > 75 ? 'üöÄ Project in Final Stages' :
                              project.progress > 50 ? '‚ö° Project Moving Steadily' :
                              project.progress > 25 ? 'üîÑ Project in Progress' :
                              project.progress > 0 ? 'üõ†Ô∏è Project Just Started' : 'üìã Project Pending Start'}
                        </div>
                    </div>
                    ` : ''}
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
                        <div>
                            <div style="font-size: 0.75rem; color: #718096; font-weight: 500; text-transform: uppercase; margin-bottom: 0.25rem;">Contractor</div>
                            <div style="font-size: 1rem; font-weight: 600; color: #2d3748;">${project.contractor || 'N/A'}</div>
                        </div>
                        <div>
                            <div style="font-size: 0.75rem; color: #718096; font-weight: 500; text-transform: uppercase; margin-bottom: 0.25rem;">Project ID</div>
                            <div style="font-size: 1rem; font-weight: 600; color: #2d3748;">${project.id}</div>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 1.5rem;">
                        <h3 style="font-size: 1.1rem; font-weight: 600; color: #2d3748; margin-bottom: 0.5rem;">AI Analysis</h3>
                        <div id="aiAnalysis_${project.id}" style="
                            background: #f8fafc;
                            border: 1px solid #e2e8f0;
                            border-radius: 8px;
                            padding: 1rem;
                            color: #4a5568;
                        ">
                            <div style="text-align: center; padding: 2rem;">
                                <div style="font-size: 2rem; margin-bottom: 0.5rem;">ü§ñ</div>
                                <div>Click "AI Analysis" to get detailed insights about this project</div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                        <button onclick="analyzeProject('${project.id}')" style="
                            background: #38a169;
                            color: white;
                            border: none;
                            padding: 0.75rem 1.5rem;
                            border-radius: 8px;
                            cursor: pointer;
                            font-weight: 600;
                        ">ü§ñ AI Analysis</button>
                        <button onclick="this.closest('.modal').remove()" style="
                            background: #e2e8f0;
                            color: #4a5568;
                            border: none;
                            padding: 0.75rem 1.5rem;
                            border-radius: 8px;
                            cursor: pointer;
                            font-weight: 600;
                        ">Close</button>
                    </div>
                </div>
            `;
            
            modal.className = 'modal';
            document.body.appendChild(modal);
            
            // Center the project on map
            if (project.geoPoint) {
                map.setView([project.geoPoint.latitude, project.geoPoint.longitude], 15);
            }
        }

        // Authentication system
        const authSystem = {
            showSignIn: function() {
                document.getElementById('signInModal').style.display = 'flex';
                document.getElementById('signUpModal').style.display = 'none';
            },
            
            showSignUp: function() {
                document.getElementById('signUpModal').style.display = 'flex';
                document.getElementById('signInModal').style.display = 'none';
            },
            
            hideModals: function() {
                document.getElementById('signInModal').style.display = 'none';
                document.getElementById('signUpModal').style.display = 'none';
            },
            
            handleSignIn: function(event) {
                event.preventDefault();
                const email = document.getElementById('signInEmail').value;
                const password = document.getElementById('signInPassword').value;
                
                // Simulate authentication
                setTimeout(() => {
                    alert('Sign in successful!');
                    this.hideModals();
                    this.updateUI(true, { email: email, name: email.split('@')[0] });
                }, 1000);
            },
            
            handleSignUp: function(event) {
                event.preventDefault();
                const name = document.getElementById('signUpName').value;
                const email = document.getElementById('signUpEmail').value;
                const password = document.getElementById('signUpPassword').value;
                
                // Simulate registration
                setTimeout(() => {
                    alert('Sign up successful!');
                    this.hideModals();
                    this.updateUI(true, { email: email, name: name });
                }, 1000);
            },
            
            signOut: function() {
                this.updateUI(false);
                alert('Signed out successfully!');
            },
            
            updateUI: function(isSignedIn, user = null) {
                const authButtons = document.getElementById('authButtons');
                const userMenu = document.getElementById('userMenu');
                
                if (isSignedIn && user) {
                    authButtons.style.display = 'none';
                    userMenu.style.display = 'flex';
                    document.getElementById('userName').textContent = user.name;
                } else {
                    authButtons.style.display = 'flex';
                    userMenu.style.display = 'none';
                }
            }
        };

        // Event listeners for authentication
        document.addEventListener('DOMContentLoaded', function() {
            // Sign in button
            document.getElementById('signInBtn').addEventListener('click', () => {
                authSystem.showSignIn();
            });
            
            // Sign up button
            document.getElementById('signUpBtn').addEventListener('click', () => {
                authSystem.showSignUp();
            });
            
            // Sign out button
            document.getElementById('signOutBtn').addEventListener('click', () => {
                authSystem.signOut();
            });
            
            // Sign in form
            document.getElementById('signInForm').addEventListener('submit', (e) => {
                authSystem.handleSignIn(e);
            });
            
            // Close modal button
            document.getElementById('closeModal').addEventListener('click', () => {
                authSystem.hideModals();
            });
            
            // Close modal on background click
            document.getElementById('signInModal').addEventListener('click', (e) => {
                if (e.target === e.currentTarget) {
                    authSystem.hideModals();
                }
            });
            
            document.getElementById('signUpModal').addEventListener('click', (e) => {
                if (e.target === e.currentTarget) {
                    authSystem.hideModals();
                }
            });
        });

        // Start application function
        function startApplication() {
            const loading = document.getElementById('loading');
            loading.style.display = 'block';
            
            // Simulate starting the application
            setTimeout(() => {
                loading.style.display = 'none';
                alert('Application started! You can now view projects and use the satellite map.');
            }, 3000);
        }
    </script>
</body>
</html>